<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ocularis</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Schibsted+Grotesk:ital,wght@0,400..900;1,400..900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>

<body>

    <div class="container">
        <div class="left-sidebar-container">
            <div class="left-sidebar">
                <div class="namelogo">
                    <img src="..\static\Logo.png" class="logo">
                    <div class="name">Ocularis</div>
                </div>
                <ul class="sidebar-menu">
                    <li><a>
                            <div class="icon-text-wrapper current">
                                <span class="material-symbols-outlined sidebar-symbol">newspaper</span>
                                <div>Feed</div>
                            </div>
                        </a></li>
                    <li><a href="{{ url_for('recommendations') }}">
                            <div class="icon-text-wrapper">
                                <span class="material-symbols-outlined sidebar-symbol">group</span>
                                <div>Match</div>
                            </div>
                        </a></li>
                    <li><a href="{{ url_for('profile', user_id=current_user.id) }}">
                            <div class="icon-text-wrapper">
                                <span class="material-symbols-outlined sidebar-symbol">person</span>
                                <div>Profile</div>
                            </div>
                        </a></li>
                    <li><a href="{{ url_for('logout') }}">
                            <div class="icon-text-wrapper">
                                <span class="material-symbols-outlined sidebar-symbol">logout</span>
                                <div>Logout</div>
                            </div>
                        </a></li>
                </ul>
            </div>
        </div>
        <div class="header">
            <form class="search-wrapper hide-mobile" action="{{ url_for('search.search_results') }}" method="GET">
                <input class="search" type="text" name="query" placeholder="Search" required>
                <button class="search-button" type="submit"><span
                        class="material-symbols-outlined search-symbol">search</span></button>
            </form>
            <div class="hide-pfp">
                <button class="notifs-button"><span
                        class="material-symbols-outlined notifs-symbol">notifications</span></button>
                <div class="pfp-frame-wrapper">
                    <div id="pfp3"><img src="..\static\pfp.jpg" class="pfp right"></div>
                    <div class="frame3" id="frame3">
                        <div class="frame-username">{{ current_user.first_name }} {{ current_user.last_name }}</div>
                        <div class="line"></div>
                        <div class="saved">Saved</div>
                        <div class="settings">Settings</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mobile-only">
            <img src="..\static\Logo.png" class="logo">
            <div class="button-pfp-wrapper">
                <button class="search-button"><span
                        class="material-symbols-outlined search-symbol">search</span></button>
                <button class="notifs-button"><span
                        class="material-symbols-outlined notifs-symbol">notifications</span></button>
                <div class="pfp-frame-wrapper">
                    <div id="pfp4"><img src="..\static\pfp.jpg" class="pfp right"></div>
                    <div class="frame4" id="frame4">
                        <div class="frame-username">{{ current_user.first_name }} {{ current_user.last_name }}</div>
                        <div class="line"></div>
                        <div class="saved">Saved</div>
                        <div class="settings">Settings</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="feed">
            <div class="post">
                <div class="post-title">Post</div>
                <div class="tagline-wrapper">
                    <div class="tagline-wrapper-2">
                        <img src="..\static\pfp.jpg" class="pfp">
                        <input class="post-tagline" type="text" placeholder="Do you mind sharing your work?">
                    </div>
                    <button class="image-button" id="openOverlay"><span
                            class="material-symbols-outlined image">image</span></button>
                </div>
            </div>
            <!--bakit naka-center ung post 1 kapag un lang ung content-->
            <!--fix class names-->
            {% for image in images %}
            <div class="post1">
                <div class="profile-more-wrapper">
                    <div class="profile-post">
                        <img src="..\static\pfp.jpg" class="pfp">
                        <div class="profile-name-date">
                            <div class="username"><a href="{{ url_for('profile', user_id=image[4]) }}">{{ image[5] }} {{
                                    image[6] }}</a></div>
                            <div class="date">Jan 1</div>
                        </div>
                    </div>
                    <div class="more-frame-wrapper">
                        <span class="material-symbols-outlined more-symbol"
                            id="moreBtn-{{ loop.index }}">more_horiz</span>
                        <div class="frame1" id="frame1-{{ loop.index }}">
                            <div class="save">Save</div>
                            <div class="hide">Hide</div>
                            <div class="report">Report</div>
                        </div>
                    </div>
                </div>
                <div class="caption {% if not image[2].strip() %}no-caption{% endif %}">
                    {{ image[2] }}
                </div>
                <div class="image-container"><img src="{{ image[1] }}" class="image-post"></div>
                <div class="interactions">
                    <div class="lcs">
                        <form action="{{ url_for('like_image', image_id=image[0]) }}" method="post">
                            <button type="submit" style="all: unset;">
                                <div class="partner like-button">
                                    <span class="material-symbols-outlined lcs-symbol">thumb_up</span>
                                    <div class="partner-label">Like</div>
                                </div>
                            </button>
                        </form>
                        <div class="partner" id="openOverlayComments-{{ loop.index }}">
                            <span class="material-symbols-outlined lcs-symbol">comment</span>
                            <div class="partner-label">Comment</div>
                        </div>
                        <div class="partner" id="openOverlayShare-{{ loop.index }}">
                            <span class="material-symbols-outlined lcs-symbol">share</span>
                            <div class="partner-label">Share</div>
                        </div>
                    </div>
                    <div class="metrics" id="openOverlayLikes-{{ loop.index }}">
                        {{ image[3] }} Likes
                    </div>
                </div>
            </div>
            <div class="overlay" id="overlay"> <!--stay on current view during overlay??-->
                <div class="overlay-content">
                    <button class="close-icon"><span class="material-symbols-outlined overlay-close-symbol"
                            id="closeOverlay">close</span></button>
                    <div class="overlay-title">Post</div>
                    <div class="scrollable-div" id="scrollableDiv">
                        <div class="profile-post">
                            <img src="..\static\pfp.jpg" class="pfp">
                            <div class="profile-name-date">
                                <div class="username">Lorem ipsum dolor</div>
                                <div class="date">Jan 1</div>
                            </div>
                        </div>
                        <form action="{{ url_for('upload_image') }}" method="POST" enctype="multipart/form-data">
                            <input class="overlay-tagline" type="text" id="caption" name="caption"
                                placeholder="Do you mind sharing your work?">
                            <div class="upload">
                                <span class="material-symbols-outlined overlay-upload-symbol">upload</span>
                                <div class="drop">Drop your images here or browse</div>
                                <div class="supports">Supports PNG, JPG, JPEG, and GIF</div>
                                <input class="browse-file" type="file" id="image" name="image" required>Browse
                                File</input>
                            </div>
                            <!--<div class="image-button-wrapper">
                        <div class="image-container-overlay"><img src="samplepost2.png" class="image-post"></div>
                        <button class="circled-icon-1-overlay-version"><span
                                class="material-symbols-outlined close-symbol-overlay-version">close</span></button>
                    </div>-->
                    </div>
                    <input type="submit" value="Post" class="post-button">
                    </form>
                </div>
            </div>
            <div class="overlayLikes" id="overlayLikes-{{ loop.index }}">
                <div class="overlay-content-likes">
                    <button class="close-icon"><span class="material-symbols-outlined overlay-close-symbol"
                            id="closeOverlayLikes-{{ loop.index }}">close</span></button>
                    <div class="overlay-title">Likes</div>
                    <div class="scrollable-div-likes" id="scrollableDivLikes-{{ loop.index }}">
                        <div class="profile-follow-wrapper">
                            <div class="profile-post-likes">
                                <img src="..\static\pfp.jpg" class="pfp">
                                <div class="profile-name-date">
                                    <div class="username">Lorem ipsum dolor</div>
                                    <div class="date">Jan 1</div>
                                </div>
                            </div>
                            <button class="follow-button">Follow</button>
                        </div>
                        <div class="profile-follow-wrapper">
                            <div class="profile-post-likes">
                                <img src="..\static\pfp.jpg" class="pfp">
                                <div class="profile-name-date">
                                    <div class="username">Lorem ipsum dolor</div>
                                    <div class="date">Jan 1</div>
                                </div>
                            </div>
                            <button class="follow-button">Follow</button>
                        </div>
                        <div class="profile-follow-wrapper">
                            <div class="profile-post-likes">
                                <img src="..\static\pfp.jpg" class="pfp">
                                <div class="profile-name-date">
                                    <div class="username">Lorem ipsum dolor</div>
                                    <div class="date">Jan 1</div>
                                </div>
                            </div>
                            <button class="follow-button">Follow</button>
                        </div>
                        <div class="profile-follow-wrapper">
                            <div class="profile-post-likes">
                                <img src="..\static\pfp.jpg" class="pfp">
                                <div class="profile-name-date">
                                    <div class="username">Lorem ipsum dolor</div>
                                    <div class="date">Jan 1</div>
                                </div>
                            </div>
                            <button class="follow-button">Follow</button>
                        </div>
                        <div class="profile-follow-wrapper">
                            <div class="profile-post-likes">
                                <img src="..\static\pfp.jpg" class="pfp">
                                <div class="profile-name-date">
                                    <div class="username">Lorem ipsum dolor</div>
                                    <div class="date">Jan 1</div>
                                </div>
                            </div>
                            <button class="follow-button">Follow</button>
                        </div>
                        <div class="profile-follow-wrapper">
                            <div class="profile-post-likes">
                                <img src="..\static\pfp.jpg" class="pfp">
                                <div class="profile-name-date">
                                    <div class="username">Lorem ipsum dolor</div>
                                    <div class="date">Jan 1</div>
                                </div>
                            </div>
                            <button class="follow-button">Follow</button>
                        </div>
                        <div class="profile-follow-wrapper">
                            <div class="profile-post-likes">
                                <img src="..\static\pfp.jpg" class="pfp">
                                <div class="profile-name-date">
                                    <div class="username">Lorem ipsum dolor</div>
                                    <div class="date">Jan 1</div>
                                </div>
                            </div>
                            <button class="follow-button">Follow</button>
                        </div>
                        <div class="profile-follow-wrapper">
                            <div class="profile-post-likes">
                                <img src="..\static\pfp.jpg" class="pfp">
                                <div class="profile-name-date">
                                    <div class="username">Lorem ipsum dolor</div>
                                    <div class="date">Jan 1</div>
                                </div>
                            </div>
                            <button class="follow-button">Follow</button>
                        </div>
                        <div class="profile-follow-wrapper">
                            <div class="profile-post-likes">
                                <img src="..\static\pfp.jpg" class="pfp">
                                <div class="profile-name-date">
                                    <div class="username">Lorem ipsum dolor</div>
                                    <div class="date">Jan 1</div>
                                </div>
                            </div>
                            <button class="follow-button">Follow</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="overlayComments" id="overlayComments-{{ loop.index }}">
                <div class="overlay-content-comments">
                    <button class="close-icon"><span class="material-symbols-outlined overlay-close-symbol"
                            id="closeOverlayComments-{{ loop.index }}">close</span></button>
                    <div class="overlay-title">Comments</div>
                    <div class="scrollable-div-comments" id="scrollableDivComments-{{ loop.index }}">
                        {% for comment in comments %}
                        {% if comment[1] == image[0] %}
                        <div class="profile-comment-wrapper">
                            <div class="profile-more-wrapper">
                                <div class="profile-post-comments">
                                    <img src="..\static\pfp.jpg" class="pfp">
                                    <div class="profile-name-date">
                                        <div class="username"><a href="{{ url_for('profile', user_id=comment[6]) }}">{{
                                                comment[2] }}</a></div>
                                        <div class="date">Jan 1</div>
                                    </div>
                                </div>
                                <div class="more-frame-wrapper">
                                    <span class="material-symbols-outlined more-symbol">more_horiz</span>
                                </div>
                            </div>
                            <div class="comment-like-wrapper">
                                <div class="comment">{{ comment[3] }}</div>
                                <div class="like-metrics-wrapper">
                                    <form action="{{ url_for('like_comment', comment_id=comment[0]) }}" method="post">
                                        <button type="submit" style="all: unset;">
                                            <div class="partner like-button"> <span
                                                    class="material-symbols-outlined lcs-symbol">thumb_up</span>
                                                <div class="partner-label">Like</div>
                                            </div>
                                        </button>
                                    </form>
                                    <div class="metrics" id="openOverlayLikes-{{ loop.index }}">
                                        {{ comment[5] }} Likes
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="line-comments"></div>
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div class="comment-bar">
                        <img src="..\static\pfp.jpg" class="pfp">
                        <div class="comment-text">
                            <form action="{{ url_for('post_comment', image_id=image[0]) }}" method="POST">
                                <input class="tagline-comment" type="text" name="comment"
                                    placeholder="Enter your comment" required>
                                <button class="send-button" type="submit">Send</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="overlayShare" id="overlayShare-{{ loop.index }}">
                <div class="overlay-content-share">
                    <button class="close-icon"><span class="material-symbols-outlined overlay-close-symbol"
                            id="closeOverlayShare-{{ loop.index }}">close</span></button>
                    <div class="overlay-title">Share</div>
                    <div class="share-wrapper">
                        <div class="share-via">Share via</div>
                        <div class="icon-grid">
                            <img src="..\static\fb.png" class="fb">
                            <img src="..\static\ig.png" class="ig">
                            <img src="..\static\x.png" class="x">
                            <img src="..\static\gmail.png" class="gmail">
                            <img src="..\static\linkedin.png" class="linkedin">
                            <img src="..\static\telegram.png" class="telegram">
                        </div>
                        <div class="or-copy-link">or copy link</div>
                        <div class="link-wrapper">
                            <div class="link">https://ocularis.app/post/123</div>
                            <button class="link-button"><span
                                    class="material-symbols-outlined link-symbol">content_copy</span></button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="right-sidebar-container">
            <div class="right-sidebar">
                <div class="pfp-frame-wrapper">
                    <div id="pfp"><img src="..\static\pfp.jpg" class="pfp right"></div>
                    <div class="frame2" id="frame2">
                        <div class="frame-username">{{ current_user.first_name }} {{ current_user.last_name }}</div>
                        <div class="line"></div>
                        <div class="saved">Saved</div>
                        <div class="settings">Settings</div>
                    </div>
                </div>
                <div class="notifs">
                    <div class="notifs-title">
                        Notifs
                    </div>
                    <!--
                    <div class="notifs-empty">
                        <span class="material-symbols-outlined empty-symbol">sentiment_dissatisfied</span>
                        <div class="oops">Oops!</div>
                        <div class="nothing">There’s nothing to show here at the moment.</div>
                    </div>
                    -->
                    <div class="notif-bar">
                        <img src="..\static\pfp.jpg" class="pfp img-notif-request">
                        <div class="notif-details">
                            <div class="notif-text">
                                Jane Doe liked your post.
                            </div>
                            <div class="notif-date">
                                Jan 1
                            </div>
                        </div>
                    </div>
                </div>
                <div class="requests">
                    <div class="requests-title">
                        Requests
                    </div>
                    <div class="request-bar">
                        <img src="..\static\pfp.jpg" class="pfp img-notif-request">
                        <div class="request-details">
                            <div class="request-text">
                                Jane Doe sent you a friend request.
                            </div>
                            <div class="request-date">
                                Jan 1
                            </div>
                            <div class="request-icons">
                                <button class="circled-icon-1"><span
                                        class="material-symbols-outlined close-symbol">close</span></button>
                                <button class="circled-icon-2"><span
                                        class="material-symbols-outlined check-symbol">check</span></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let scrollPosition = 0;

        function setupOverlay(overlaySelector, openBtnId, closeBtnId) {
            const overlay = document.querySelector(overlaySelector);
            const openBtn = document.getElementById(openBtnId);
            const closeBtn = document.getElementById(closeBtnId);

            if (!overlay || !openBtn || !closeBtn) return;

            openBtn.addEventListener('click', () => {
                scrollPosition = window.scrollY;
                document.body.style.top = `-${scrollPosition}px`;
                document.body.classList.add('no-scrolling');
                overlay.classList.add('active');
            });

            function closeOverlay() {
                overlay.classList.remove('active');
                document.body.classList.remove('no-scrolling');
                document.body.style.top = '';
                window.scrollTo(0, scrollPosition);
            }

            closeBtn.addEventListener('click', closeOverlay);

            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeOverlay();
                }
            });
        }

        // Static overlay setup
        setupOverlay('.overlay', 'openOverlay', 'closeOverlay');

        // Dynamic overlays setup for Likes, Comments, and Shares
        document.querySelectorAll('[id^="overlayLikes-"]').forEach((overlay) => {
            const index = overlay.id.split('-')[1];
            setupOverlay(`#overlayLikes-${index}`, `openOverlayLikes-${index}`, `closeOverlayLikes-${index}`);
        });

        document.querySelectorAll('[id^="overlayComments-"]').forEach((overlay) => {
            const index = overlay.id.split('-')[1];
            setupOverlay(`#overlayComments-${index}`, `openOverlayComments-${index}`, `closeOverlayComments-${index}`);
        });

        document.querySelectorAll('[id^="overlayShare-"]').forEach((overlay) => {
            const index = overlay.id.split('-')[1];
            setupOverlay(`#overlayShare-${index}`, `openOverlayShare-${index}`, `closeOverlayShare-${index}`);
        });

        // Hide all frames initially
        document.querySelectorAll('[id^="frame"]').forEach((frame) => {
            frame.style.display = 'none';
        });

        // Track manually opened sets (frames 2–4)
        let isFrame234Open = {};

        // Setup for dynamic frame1 toggles (e.g., frame1-1, frame1-2...)
        document.querySelectorAll('[id^="moreBtn-"]').forEach((moreBtn) => {
            const index = moreBtn.id.split('-')[1];
            const frame1 = document.getElementById(`frame1-${index}`);

            moreBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                const isOpen = frame1.style.display === 'block';
                frame1.style.display = isOpen ? 'none' : 'block';

                // Close frames 2–4 if open
                for (let i in isFrame234Open) {
                    if (isFrame234Open[i]) {
                        ['2', '3', '4'].forEach(n => {
                            const f = document.getElementById(`frame${n}-${i}`);
                            if (f) f.style.display = 'none';
                        });
                        isFrame234Open[i] = false;
                    }
                }
            });
        });

        // Setup for frames 2–4 (pfp, pfp3, pfp4)
        document.querySelectorAll('[id^="pfp"]').forEach((pfp) => {
            const index = pfp.id.replace(/[^\d]/g, '');
            const frame2 = document.getElementById(`frame2-${index}`);
            const frame3 = document.getElementById(`frame3-${index}`);
            const frame4 = document.getElementById(`frame4-${index}`);
            const frame1 = document.getElementById(`frame1-${index}`);

            pfp.addEventListener('click', function (e) {
                e.stopPropagation();
                const isOpen = frame2 && frame2.style.display === 'block';

                if (isOpen) {
                    if (frame2) frame2.style.display = 'none';
                    if (frame3) frame3.style.display = 'none';
                    if (frame4) frame4.style.display = 'none';
                    isFrame234Open[index] = false;
                } else {
                    if (frame2) frame2.style.display = 'block';
                    if (frame3) frame3.style.display = 'block';
                    if (frame4) frame4.style.display = 'block';
                    if (frame1) frame1.style.display = 'none';
                    isFrame234Open[index] = true;
                }
            });
        });

        // Close frames on outside click
        document.addEventListener('click', function (event) {
            document.querySelectorAll('[id^="frame1-"]').forEach((frame1) => {
                const index = frame1.id.split('-')[1];
                const btn = document.getElementById(`moreBtn-${index}`);
                if (!frame1.contains(event.target) && event.target !== btn) {
                    frame1.style.display = 'none';
                }
            });

            document.querySelectorAll('[id^="frame2-"]').forEach((frame2) => {
                const index = frame2.id.split('-')[1];
                const frame3 = document.getElementById(`frame3-${index}`);
                const frame4 = document.getElementById(`frame4-${index}`);
                const pfp = document.getElementById(`pfp${index === '1' ? '' : index}`);

                if (
                    !frame2.contains(event.target) &&
                    !frame3.contains(event.target) &&
                    !frame4.contains(event.target) &&
                    event.target !== pfp
                ) {
                    if (frame2) frame2.style.display = 'none';
                    if (frame3) frame3.style.display = 'none';
                    if (frame4) frame4.style.display = 'none';
                    isFrame234Open[index] = false;
                }
            });
        });

        // Sync on window resize
        window.addEventListener('resize', function () {
            for (let index in isFrame234Open) {
                if (isFrame234Open[index]) {
                    ['2', '3', '4'].forEach(n => {
                        const frame = document.getElementById(`frame${n}-${index}`);
                        if (frame) frame.style.display = 'block';
                    });
                }
            }
        });

        function checkScrollbar() {
            const div = document.getElementById('scrollableDiv');
            const div1 = document.getElementById('scrollableDivLikes');
            const div2 = document.getElementById('scrollableDivComments');


            div.classList.remove('no-scroll', 'has-scroll');

            if (div.scrollHeight > div.clientHeight) {
                div.classList.add('has-scroll');
            } else {
                div.classList.add('no-scroll');
            }

            if (div1.scrollHeight > div1.clientHeight) {
                div1.classList.add('has-scroll');
            } else {
                div1.classList.add('no-scroll');
            }

            if (div2.scrollHeight > div2.clientHeight) {
                div2.classList.add('has-scroll');
            } else {
                div2.classList.add('no-scroll');
            }
        }

        window.onload = checkScrollbar;


        const likeButtons = document.querySelectorAll(".like-button");

        likeButtons.forEach(button => {
            button.addEventListener("click", () => {
                button.classList.toggle("liked");
            });
        });

        function setFullHeight() {
            document.querySelector('.right-sidebar').style.height = window.innerHeight + 'px';
            document.querySelector('.left-sidebar').style.height = window.innerHeight + 'px';
        }
        window.addEventListener('resize', setFullHeight);
        window.addEventListener('load', setFullHeight);

    </script>

</body>

</html>